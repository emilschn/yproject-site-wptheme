function WDGCampaignTurnoverSimulator(){this.initFinanceFormEvents(),this.initAdjustments(),this.initDisplayedInfos(),this.refreshYears()}function WDGCampaignDashboard(){this.walletTimetableDatatable,this.createTableRequest,this.initWithHash(),this.initLinks(),this.initMenu(),this.initHelp(),this.initStatsSubTabs(),this.drawTimetable(),this.initAjaxForms(),this.initHome(),this.initContacts(),this.initQtip(),this.initTeam(),this.initRoyalties(),this.initFinance(),this.initCampaign()}function addCheckByPMCallback(e){if($("form#form-contacts-add-check p.errors").remove(),""!=e)try{var t=JSON.parse(e),a=t.errors,i=0;for(var n in a){if(""!==n)i++,$("<p class='errors'>"+a[n][1]+"</p>").insertBefore($("form#form-contacts-add-check div#field-"+a[n][0]+" .field-container"))}if(i>0){var r=$("form#form-contacts-add-check").find(".errors").first().parent();1===r.length&&wdgCampaignDashboard.scrollTo(r)}else"1"===t.success&&($("form#form-contacts-add-check .loading").show(),$("form#form-contacts-add-check button").hide(),window.location.reload())}catch(e){}}var wdgCampaignDashboard;WDGCampaignTurnoverSimulator.prototype.initFinanceFormEvents=function(){var e=this;$("#select-new_funding_duration").change(function(){e.refreshYears()}),$("#new_maximum_goal, #new_roi_percent_estimated").bind("keyup click",function(){e.refreshTurnover()})},WDGCampaignTurnoverSimulator.prototype.initAdjustments=function(){var e=this;$("#field-declarations_checked").length>0&&$("#field-declarations_checked .select-multiple-items label.radio-label").click(function(){setTimeout(function(){e.refreshAdjustmentDeclarationsTurnover()},800)})},WDGCampaignTurnoverSimulator.prototype.refreshAdjustmentDeclarationsTurnover=function(){var e=0,t="";$("#field-declarations_checked .select-multiple-items label.radio-label input").each(function(){if($(this).is(":checked")){var a=$(this).val().substring(12);if($("#list-declarations #declaration-item-more-"+a).length>0){var i=$("#list-declarations #declaration-item-more-"+a).data("turnover-total");void 0!=i&&(""!=t&&(t+="+ "),t+=i+" € ",e+=i)}}}),t+="=> Total déclaré : "+e.toString()+" €.",$("#field-declarations_checked .turnover-total-description").length>0?$("#field-declarations_checked .turnover-total-description").html(t):$("#field-declarations_checked").append('<div class="turnover-total-description">'+t+"</div>")},WDGCampaignTurnoverSimulator.prototype.initDisplayedInfos=function(){var e=$("#estimated-turnover").data("symbol");$("#total-roi").html("0 "+e),$("#total-funding").html("---"),$("#medium-rend").html("--- %").css("color","#2B2C2C"),$("#gain").html("");for(var t=this.getFundingDuration(),a=0;a<t;a++)$("#roi-amount-"+a).html("0 "+e)},WDGCampaignTurnoverSimulator.prototype.refreshYears=function(){var e=$("#estimated-turnover tr").length,t=this.getFundingDuration();if(t>e){if(t<=20)for(var a=0;a<t-e;a++)$("#estimated-turnover").append('<tr><td>Année&nbsp;<span class="year">'+(a+1+e)+'</span></td><td class="field field-value" data-type="number" data-id="new_estimated_turnover_'+(a+e)+'"><i class="right fa" aria-hidden="true"></i><input type="text" pattern="d*" value="0" id="new_estimated_turnover_'+(a+e)+'" class="right-icon">&nbsp;'+$("#estimated-turnover").data("symbol")+'</td><td id="roi-amount-'+(a+e)+'">0 '+$("#estimated-turnover").data("symbol")+"</td></tr>")}else $("#estimated-turnover tr").hide(),$("#estimated-turnover tr").slice(0,t).show();this.refreshTurnover(),this.reinitTurnoverEvents()},WDGCampaignTurnoverSimulator.prototype.refreshTurnover=function(){var e=this.getFundingDuration(),t=this.getInputValue("new_maximum_goal",2),a=this.getInputValue("new_roi_percent_estimated",10);if(e>0&&t>0){var i=$("#estimated-turnover").data("symbol");$("#total-funding").html(this.getNumberValueToString(t)+" &euro;");for(var n=0,r=0;r<e;r++){var o="%"==i?t*this.getInputValue("new_estimated_turnover_"+r,2)/100:a*this.getInputValue("new_estimated_turnover_"+r,2)/100;o=o.toFixed(2),$("#roi-amount-"+r).html(this.getNumberValueToString(o)+" &euro;"),n+=parseFloat(o)}$("#total-roi").html(this.getNumberValueToString(n)+" &euro;");var s=Math.round(100*(n/t-1)*100)/100,d=this.getNumberValueToString(s);s>0&&(d="+"+d),$("#medium-rend").html(d+" %"),$("#medium-rend").css("color","#2B2C2C"),s<0&&($("#medium-rend").css("color","#EA4F51").css("display","inline-block").css("margin",0),$("#medium-rend").append("<br>(insuffisant)"));var l=n/t,c=this.getNumberValueToString(l);$("#gain").html("x"+c+" en "+e+" ans")}else this.initDisplayedInfos()},WDGCampaignTurnoverSimulator.prototype.reinitTurnoverEvents=function(){for(var e=this,t=e.getFundingDuration(),a=0;a<t;a++)$("#new_estimated_turnover_"+a).length>0&&($("#new_estimated_turnover_"+a).unbind(),$("#new_estimated_turnover_"+a).bind("click keyup",function(){e.refreshTurnover()}),e.formatTurnover("new_estimated_turnover_"+a),$("#new_estimated_turnover_"+a).change(function(){e.formatTurnover($(this).attr("id"))}))},WDGCampaignTurnoverSimulator.prototype.getFundingDuration=function(){var e=parseInt($("#select-new_funding_duration").val());return(0==e||isNaN(e))&&(e=5),e},WDGCampaignTurnoverSimulator.prototype.getInputValue=function(e,t){var a=$("#"+e).length>0?$("#"+e).val():$("span[data-id="+e+"] span").text();return a=a.split(" ").join("").replace(",","."),parseFloat(a).toFixed(t)},WDGCampaignTurnoverSimulator.prototype.getNumberValueToString=function(e){return e=parseFloat(e).toFixed(2),JSHelpers.formatNumber(e,"")},WDGCampaignTurnoverSimulator.prototype.formatTurnover=function(e){var t=$("#"+e).val(),a=JSHelpers.formatNumber(JSHelpers.formatTextToNumber(t),"");$("#"+e).val(a)},WDGCampaignDashboard.prototype.initWithHash=function(){var e=window.location.hash.substring(1);""!==e?this.switchTab(e):this.switchTab("home")},WDGCampaignDashboard.prototype.initLinks=function(){var e=this;$("a").click(function(){void 0!==$(this).attr("href")&&""!==$(this).attr("href")&&-1===$(this).attr("href").indexOf("#")&&(void 0!==e.createTableRequest&&e.createTableRequest.abort(),""!==YPUIFunctions.currentRequest&&YPUIFunctions.currentRequest.abort())})},WDGCampaignDashboard.prototype.initMenu=function(){var e=this;$("ul.nav-menu li a").each(function(){$(this).click(function(){e.switchTab($(this).data("tab"))})}),$("a.switch-tab").click(function(){e.switchTab($(this).attr("href").substr(1))})},WDGCampaignDashboard.prototype.initHelp=function(){$(".help-item-remove").hover(function(){$(this).parent().addClass("hover")},function(){$(this).parent().removeClass("hover")}),$(".help-item-remove").click(function(){$(this).parent().fadeOut(100),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"remove_help_item",name:$(this).data("item-name"),version:$(this).data("item-version")}})})},WDGCampaignDashboard.prototype.initStatsSubTabs=function(){$("ul.menu-onglet li a").each(function(){$(this).click(function(){""!==$(this).data("subtab")&&($(".stat-subtab").hide(),$("#stat-subtab-"+$(this).data("subtab")).show(),$("ul.menu-onglet li a").removeClass("focus"),$(this).addClass("focus"),"leveedefonds"==$(this).data("subtab")&&$("#sup-stats-chart").width(600))})})},WDGCampaignDashboard.prototype.switchTab=function(e){$("ul.nav-menu li").removeClass("selected"),$("div#item-body > div.item-body-tab").hide(),$("ul.nav-menu li#menu-item-"+e).addClass("selected"),$("div#item-body > div#item-body-"+e).show(),"royalties"==e&&void 0!=this.walletTimetableDatatable&&this.walletTimetableDatatable.draw(),"contacts"==e&&void 0!=this.table&&this.table.draw(),this.scrollTo($("#item-body"))},WDGCampaignDashboard.prototype.initAjaxForms=function(){var e=this;$("form.ajax-db-form").submit(function(t){if(""==$(this).attr("action")||void 0==$(this).attr("action")){if(t.preventDefault(),void 0==$(this).data("action"))return!1;var a=$(this),i={action:$(this).data("action"),campaign_id:campaign_id};$(this).find(".field").each(function(e){var t=$(this).data("id");if(void 0!=t){switch($(this).data("type")){case"datetime":var a=$(this).find("input:eq(0)").val().split("/");i[t]=a[1]+"/"+a[0]+"/"+a[2]+" "+$(this).find("select:eq(0)").val()+":"+$(this).find("select:eq(1)").val();break;case"editor":i[t]=tinyMCE.get(t).getContent();break;case"check":i[t]=$("#"+t).is(":checked");break;case"multicheck":var n=new Array;$("input",this).each(function(){$(this).is(":visible")&&$(this).is(":checked")&&n.push($(this).val())}),i[t]=n;break;case"checkboxes":$("input",this).each(function(){$(this).is(":checked")&&(i[t]=$(this).is(":checked"))});break;case"text":case"number":case"date":case"link":case"textarea":case"select":default:i[t]=$(":input",this).val()}void 0==i[t]&&delete i[t]}});var n=$("#"+$(this).attr("id")+"_button");if(n.find(".button-text").hide(),n.find(".button-waiting").show(),$(":input",this).prop("disabled",!0),a.find(".feedback_save span").fadeOut(),"true"==$(this).data("confirm")||1==$(this).data("confirm"))var r=window.confirm("Etes-vous sûrs de vouloir enregistrer ces modifications ?");else r=!0;r?$.ajax({type:"POST",url:ajax_object.ajax_url,data:i}).done(function(t){if(""!=t){var i=JSON.parse(t);feedback=i;var n=!1;for(var r in feedback.errors)n=$("#field-"+r+" .field-error"),$("#field-"+r+" .field-error").html(feedback.errors[r]),$("#field-"+r+" .field-error").show(),$("#field-"+r).find("i.fa.validation").remove();for(var r in feedback.success)$("#field-"+r+" .field-error").hide(),thisinput=a.find("input[name="+r+"],select[name=select-"+r+"]"),e.removeFieldError(thisinput),thisinput.parent().parent().find("i.fa.validation").remove(),thisinput.addClass("validation"),thisinput.parent().after('<i class="fa fa-check validation" aria-hidden="true"></i>');!1!==n?(e.scrollTo(n),a.find(".save_errors").fadeIn()):a.find(".save_ok").fadeIn()}}).fail(function(){a.find(".save_fail").fadeIn()}).always(function(){n.find(".button-waiting").hide(),n.find(".button-text").show(),a.find(":input").prop("disabled",!1)}):(n.find(".button-waiting").hide(),n.find(".button-text").show(),a.find(":input").prop("disabled",!1))}})},WDGCampaignDashboard.prototype.initHome=function(){($("#innbdayvote").length>0||$("#innbdaycollecte").length>0)&&(updateDate=function(e,t){if($("#"+t).empty(),$("#"+e).val()<=$("#"+e).prop("max")&&$("#"+e).val()>=$("#"+e).prop("min")){var a=new Date,i=$("#"+e).val();a.setDate(a.getDate()+parseInt(i)),$("#"+t).prepend(" "+a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear())}else $("#"+t).prepend("La durée doit être comprise entre "+$("#"+e).prop("min")+" et "+$("#"+e).prop("max")+" jours")},updateDate("innbdaycollecte","previewenddatecollecte"),updateDate("innbdayvote","previewenddatevote"),$("#innbdaycollecte").on("keyup change",function(){updateDate("innbdaycollecte","previewenddatecollecte")}),$("#innbdayvote").on("keyup change",function(){updateDate("innbdayvote","previewenddatevote")}))},WDGCampaignDashboard.prototype.initContacts=function(){var e,t,a,i=this;if($("#direct-mail #mail-preview-button").click(function(){e=tinyMCE.get("mail_content").getContent(),""==(t=$("#direct-mail #mail-title").val())?i.fieldError($("#direct-mail #mail-title"),"L'objet du mail ne peut être vide"):(i.removeFieldError($("#direct-mail #mail-title")),a=$(this).html(),$(this).html('<i class="fa fa-spinner fa-spin fa-1x fa-fw"></i>'),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"preview_mail_message",id_campaign:campaign_id,mail_content:e,mail_title:t}}).done(function(e){var t=JSON.parse(e);$("#direct-mail .preview-title").html('<i class="fa fa-envelope" aria-hidden="true"></i>&nbsp;'+t.content.title),$("#direct-mail .preview").html(t.content.body),$("#direct-mail .step-write").slideUp(),$("#direct-mail .step-confirm").slideDown(),$("#direct-mail #mail-preview-button").html(a)}))}),$("#direct-mail #mail-back-button").click(function(){$("#direct-mail .step-confirm").slideUp(),$("#direct-mail .step-write").slideDown()}),$(".show-notifications").click(function(e){e.preventDefault(),$("#form-notifications #mail_type").val($(this).data("mailtype")),$("#form-notifications").hide(),$("#form-notifications").slideDown(100)}),$(".show-notifications-end-vote").click(function(e){e.preventDefault(),$("#form-notifications-end-vote #mail_type").val($(this).data("mailtype")),$("#form-notifications-end-vote").hide(),$("#form-notifications-end-vote").slideDown(100)}),$(".show-notifications-end").click(function(e){e.preventDefault(),$("#form-notifications-end #notifications_content").html($(this).html()),$("#form-notifications-end #mail_type").val($(this).data("mailtype")),$("#form-notifications-end").hide(),$("#form-notifications-end").slideDown(100)}),$(".button-test-notification").click(function(e){e.preventDefault();var t=this;$(this).addClass("disabled");var a=$($(this).siblings("input[name=action]")[0]).val(),i=$($(this).siblings("input[name=campaign_id]")[0]).val(),n=$($(this).siblings("input[name=mail_type]")[0]).val(),r="",o="",s="";$(this).siblings("input[name=image_description]").length>0&&(r=tinyMCE.get("testimony").getContent(),o=$($(this).siblings("input[name=image_url]")[0]).val(),s=$($(this).siblings("input[name=image_description]")[0]).val()),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"send_test_notifications",campaign_id:i,notif_type:a,mail_type:n,send_option:"test",testimony:r,image_url:o,image_description:s}}).done(function(e){$(t).removeClass("disabled"),"1"==e?alert("Test envoyé"):alert("Erreur envoi du test")})}),$(".button-contacts-add-check").length>0){$(".button-contacts-add-check").click(function(){$("#form-contacts-add-check").slideDown(30),i.scrollTo($("#form-contacts-add-check"))});var n=new Array;$("#button-contacts-add-check-search").click(function(e){e.preventDefault(),$("#button-contacts-add-check-search").addClass("disabled"),$(".add-check-feedback").hide(),$("#fields-user-info").hide(),$("#fields-orga-info").hide(),$("#fields-orga-select").hide(),$("#fields-save-info").hide(),$("#add-check-search-loading").show(),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"search_user_by_email",email:$("#form-contacts-add-check #user-email").val()}}).done(function(e){$("#button-contacts-add-check-search").removeClass("disabled"),$("#add-check-search-loading").hide();var t=JSON.parse(e);switch(t.user_type){case"user":$("#add-check-feedback-found-orga").hide(),$("#add-check-feedback-found-user").show(),$("#fields-user-info").show(),$("#fields-user-info #select-gender").val(t.user_data.user.gender),$("#fields-user-info #firstname").val(t.user_data.user.firstname),$("#fields-user-info #lastname").val(t.user_data.user.lastname),$("#fields-user-info #field-birthday .adddatepicker").datepicker("setDate",t.user_data.user.birthday_day+"/"+t.user_data.user.birthday_month+"/"+t.user_data.user.birthday_year),$("#fields-user-info #birthplace").val(t.user_data.user.birthplace),$("#fields-user-info #select-birthplace_department").val(t.user_data.user.birthplace_department),$("#fields-user-info #select-birthplace_district").val(t.user_data.user.birthplace_district),$("#fields-user-info #select-birthplace_country").val(t.user_data.user.birthplace_country),$("#fields-user-info #select-nationality").val(t.user_data.user.nationality),$("#fields-user-info #address_number").val(t.user_data.user.address_number),$("#fields-user-info #select-address_number_complement").val(t.user_data.user.address_number_complement),$("#fields-user-info #address").val(t.user_data.user.address),$("#fields-user-info #postal_code").val(t.user_data.user.postal_code),$("#fields-user-info #city").val(t.user_data.user.city),$("#fields-user-info #select-country").val(t.user_data.user.country),$("form#form-contacts-add-check select#select-orga_id option").each(function(){""!==$(this).val()&&"new-orga"!==$(this).val()&&$(this).remove()}),n=new Array;for(var a=t.user_data.orga_list,i=t.user_data.orga_list.length,r=0;r<i;r++)$("form#form-contacts-add-check select#select-orga_id").append('<option value="'+a[r].wpref+'">'+a[r].name+"</option>"),n[a[r].wpref]=a[r];break;case"orga":$("#add-check-feedback-found-user").hide(),$("#fields-user-info").hide(),$("#add-check-feedback-found-orga").show();break;default:$("#add-check-feedback-found-orga").hide(),$("#add-check-feedback-not-found").show(),$("#fields-user-info").show(),$("#fields-user-info #select-gender").val(""),$("#fields-user-info #firstname").val(""),$("#fields-user-info #lastname").val(""),$("#fields-user-info #field-birthday .adddatepicker").datepicker("setDate","01/01/1970"),$("#fields-user-info #birthplace").val(""),$("#fields-user-info #select-nationality").val(""),$("#fields-user-info #address_number").val(""),$("#fields-user-info #select-address_number_complement").val(""),$("#fields-user-info #address").val(""),$("#fields-user-info #postal_code").val(""),$("#fields-user-info #city").val(""),$("#fields-user-info #select-country").val("")}})}),$("form#form-contacts-add-check select#select-user_type").change(function(){""!=$("form#form-contacts-add-check select#select-user_type").val()?"user"!=$("form#form-contacts-add-check select#select-user_type").val()?($("#fields-save-info").hide(),$("#fields-orga-select").show()):($("#fields-orga-select").hide(),$("#fields-save-info").show()):($("#fields-orga-select").hide(),$("#fields-save-info").hide()),$("#fields-orga-info").hide()}),$("form#form-contacts-add-check select#select-orga_id").change(function(){if(""!=$("form#form-contacts-add-check select#select-orga_id").val()){if("new-orga"==$("form#form-contacts-add-check select#select-orga_id").val())$("#fields-orga-info #org_name").val(""),$("#fields-orga-info #org_email").val(""),$("#fields-orga-info #org_website").val(""),$("#fields-orga-info #org_legalform").val(""),$("#fields-orga-info #org_idnumber").val(""),$("#fields-orga-info #org_rcs").val(""),$("#fields-orga-info #org_capital").val(""),$("#fields-orga-info #org_address_number").val(""),$("#fields-orga-info #select-org_address_number_comp").val(""),$("#fields-orga-info #org_address").val(""),$("#fields-orga-info #org_postal_code").val(""),$("#fields-orga-info #org_city").val(""),$("#fields-orga-info #select-org_nationality").val("");else{var e=n[$("form#form-contacts-add-check select#select-orga_id").val()];$("#fields-orga-info #org_name").val(e.name),$("#fields-orga-info #org_email").val(e.email),$("#fields-orga-info #org_website").val(e.website),$("#fields-orga-info #org_legalform").val(e.legalform),$("#fields-orga-info #org_idnumber").val(e.idnumber),$("#fields-orga-info #org_rcs").val(e.rcs),$("#fields-orga-info #org_capital").val(e.capital),$("#fields-orga-info #org_address_number").val(e.address_number),$("#fields-orga-info #select-org_address_number_comp").val(e.address_number_comp),$("#fields-orga-info #org_address").val(e.address),$("#fields-orga-info #org_postal_code").val(e.postal_code),$("#fields-orga-info #org_city").val(e.city),$("#fields-orga-info #select-org_nationality").val(e.nationality)}$("#fields-orga-info").show(),$("#fields-save-info").show()}else $("#fields-orga-info").hide(),$("#fields-save-info").hide()})}$("div#investment-drafts-list").length>0&&($("button.btn-view-investment-draft").click(function(){var e=$(this).data("draftid");$("form#preview-investment-draft-"+e).toggle()}),$("button.apply-draft-data").click(function(){var e=$(this).parent().data("userid"),t=$(this).parent().data("orgaid"),a=$(this).parent().data("draftid"),i=$(this).data("type"),n=$(this).data("value");$(this).hide(),"all"===i&&$("#preview-investment-draft-"+a+" button.apply-draft-data").hide(),$("#preview-investment-draft-"+a+" #img-loading-data-"+i).show(),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"apply_draft_data",user_id:e,orga_id:t,draft_id:a,data_type:i,data_value:n}}).done(function(e){$('<i class="text-green">'+e+"</i>").insertAfter($("#preview-investment-draft-"+a+" #img-loading-data-"+i)),$("#preview-investment-draft-"+a+" #img-loading-data-"+i).hide()})}),$("button.create-investment-from-draft").click(function(){var e=$(this).parent().data("draftid"),t=$(this).parent().data("campaignid");$(this).hide(),$("#preview-investment-draft-"+e+" #img-loading-create-investment").show(),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"create_investment_from_draft",draft_id:e,campaign_id:t}}).done(function(t){"1"==t?window.location.reload():($("#preview-investment-draft-"+e+" #img-loading-create-investment").after("<em>"+t+"</em>"),$("#preview-investment-draft-"+e+" #img-loading-create-investment").hide())})}))},WDGCampaignDashboard.prototype.updateEditOrgaBtn=function(e){if(""!==$("#select-new_project_organization").val()){var t=e.find($("#edit-orga-button")).show(),a=$("#select-new_project_organization").find("option:selected").text();t.attr("href","#"),t.text("Editer "+a)}else t.hide()},WDGCampaignDashboard.prototype.getContactsTable=function(e,t){var a=this;a.createTableRequest=$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"create_contacts_table",id_campaign:t,data:e},timeout:3e4}).done(function(e){a.createTableRequest=void 0,$("#ajax-contacts-load").after(e),$("#ajax-loader-img").hide();var t=result_contacts_table.id_column_user_id-result_contacts_table.id_column_index-2;a.table=$("#contacts-table").DataTable({responsive:{details:{type:"column",target:"td:not(:first-child)"}},scrollY:"70vh",scrollCollapse:!0,paging:!1,order:[[result_contacts_table.default_sort,"desc"]],columnDefs:[{targets:result_contacts_table.array_hidden,visible:!1},{className:"select-checkbox",targets:0,orderable:!1},{width:"30px",className:"dt-body-center nopadding",targets:[3,4,5]}],select:{style:"multi",selector:"td:first-child"},dom:"Bfrtip",buttons:[{text:'<i class="fa fa-square-o" aria-hidden="true"></i> Sélectionner les éléments affichés',action:function(){a.table.rows({search:"applied"}).select()}},{extend:"selected",text:'<i class="fa fa-envelope" aria-hidden="true"></i> Envoyer un mail',action:function(e,t,i,n){$("#send-mail-tab").slideDown();$(this).data("target");a.scrollTo($("#send-mail-tab"))}},{extend:"collection",text:'<i class="fa fa-eye" aria-hidden="true"></i> Informations à afficher',buttons:[{extend:"colvis",text:'<i class="fa fa-columns" aria-hidden="true"></i> Colonnes à afficher',columns:":gt("+result_contacts_table.id_column_index+"):lt("+t+")",collectionLayout:"two-column"},{extend:"colvisGroup",text:"Tout afficher",show:":gt("+result_contacts_table.id_column_index+"):lt("+t+"):hidden"},{extend:"colvisGroup",text:"Tout masquer",hide:":gt("+result_contacts_table.id_column_index+")"},{extend:"colvisRestore",text:'<i class="fa fa-refresh" aria-hidden="true"></i> Rétablir colonnes par défaut'}]},{extend:"collection",text:'<i class="fa fa-download" aria-hidden="true"></i> Exporter',buttons:[{extend:"excel",text:'<i class="fa fa-file-excel-o" aria-hidden="true"></i> Fichier Excel',exportOptions:{modifier:{columns:":visible"}}},{extend:"print",text:'<i class="fa fa-print" aria-hidden="true"></i> Imprimer',exportOptions:{modifier:{columns:":visible"}}}]}],language:{sProcessing:"Traitement en cours...",sSearch:"Rechercher&nbsp;:",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Aucun &eacute;l&eacute;ment &agrave; afficher",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"Pr&eacute;c&eacute;dent",sNext:"Suivant",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"},select:{rows:{_:"<br /><b>%d</b> contacts sélectionnés",0:"<br />Cliquez sur un contact pour le sélectionner",1:"<br /><b>1</b> contact sélectionné"}}}}),a.table.columns.adjust(),a.table.responsive.recalc(),a.table.on("column-visibility.dt",function(e,t,i,n){a.initQtip()}),a.table.on("responsive-display",function(e,t,i,n,r){a.initQtip()});var i=a.table.button(1).text();a.table.on("select.dt deselect.dt",function(e,t,n,r){var o=a.table.rows({selected:!0}).count();0==o?(a.table.button(1).text(i),$("#send-mail-tab").slideUp()):a.table.button(1).text(i+" ("+o+")");var s=!0;a.table.rows({search:"applied"}).every(function(e,t,i){-1==$.inArray(e,a.table.rows({selected:!0}).indexes())&&(s=!1)}),s?(a.table.button(0).text('<i class="fa fa-check-square-o" aria-hidden="true"></i> Déselectionner les éléments affichés'),a.table.button(0).action(function(){a.table.rows({search:"applied"}).deselect()})):(a.table.button(0).text('<i class="fa fa-square-o" aria-hidden="true"></i> Sélectionner les éléments affichés'),a.table.button(0).action(function(){a.table.rows({search:"applied"}).select()})),$("#nb-mailed-contacts").text(o);var d=[];$.each(a.table.rows({selected:!0}).data(),function(e,t){d.push(t[result_contacts_table.id_column_user_id-1])}),$("#mail_recipients").val(d)}),$(a.table.table().container()).on("keyup","tfoot .text input",function(){a.table.column($(this).data("index")).search(this.value).draw()}),$(a.table.table().container()).on("change","tfoot .check input",function(){$(this).is(":checked")?a.table.column($(this).data("index")).search("1").draw():a.table.column($(this).data("index")).search("").draw()}),a.initQtip(),$("span.authentication-more-info a").click(function(e){e.preventDefault(),$(this).siblings("span").toggle(),"+"==$(this).text()?$(this).text("-"):$(this).text("+")})}).fail(function(){$("#ajax-contacts-load").after("<em>Le chargement du tableau a échoué</em>"),$("#ajax-loader-img").hide()})},WDGCampaignDashboard.prototype.drawTimetable=function(){$("#wdg-timetable tfoot td").each(function(){$(this).prepend('<input type="text" placeholder="Filtrer par :" class="col-filter"/><br/>')}),$("#wdg-timetable tfoot input").on("keyup change",function(){walletTimetable.column($(this).parent().index()+":visible").search(this.value).draw()}),sortColumn=0,this.walletTimetableDatatable=$("#wdg-timetable").DataTable({scrollX:!0,order:[[sortColumn,"asc"]],dom:'RC<"clear">lfrtip',lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"Tous"]],iDisplayLength:50,colVis:{buttonText:"Afficher/cacher colonnes",restore:"Restaurer",showAll:"Tout afficher",showNone:"Tout cacher",overlayFade:100},language:{sProcessing:"Traitement en cours...",sSearch:"Rechercher&nbsp;:",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"Pr&eacute;c&eacute;dent",sNext:"Suivant",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"}}})},WDGCampaignDashboard.prototype.scrollTo=function(e){$("html, body, .wdg-lightbox-padder").animate({scrollTop:e.offset().top-75},"slow")},WDGCampaignDashboard.prototype.fieldError=function(e,t){e.addClass("error"),e.removeClass("validation"),e.qtip({content:t,position:{my:"bottom center",at:"top center"},style:{classes:"wdgQtip qtip-red qtip-rounded qtip-shadow"},show:"focus",hide:"blur"}),e.parent().parent().find("i.fa.validation").remove()},WDGCampaignDashboard.prototype.removeFieldError=function(e){e.hasClass("error")&&(e.removeClass("error"),e.qtip().destroy())},WDGCampaignDashboard.prototype.initTeam=function(e){var t=this;$(".project-manage-team").click(function(){var e,a;"yproject-add-member"===(e=$(this).attr("data-action"))?a=$("#new_team_member_string")[0].value:"yproject-remove-member"===e&&(a=$(this).attr("data-user")),t.manageTeam(e,a,campaign_id)})},WDGCampaignDashboard.prototype.initRoyalties=function(){var e=this;if(e.currentOpenedROI=0,e.isRefund=0,$(".transfert-roi-open").length>0&&($(".transfert-roi-open").click(function(){$(this).data("roideclaration-id")!==e.currentOpenedROI&&(e.currentOpenedROI=$(this).data("roideclaration-id"),e.isRefund=$(this).data("refund"),$("#wdg-lightbox-transfer-roi #lightbox-content .loading-content").html(""),$("#wdg-lightbox-transfer-roi #lightbox-content .loading-image").show(),$("#wdg-lightbox-transfer-roi #lightbox-content .loading-form").hide(),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"display_roi_user_list",roideclaration_id:$(this).data("roideclaration-id"),is_refund:$(this).data("refund")}}).done(function(t){var a="Versement impossible";"0"!=t&&(a="<table>",a+="<tr><td>Utilisateur</td><td>Investissement</td><td>Versement</td><td>Commission</td></tr>",a+=t,a+="</table>",$("#wdg-lightbox-transfer-roi #lightbox-content .loading-form input#hidden-roi-id").val(e.currentOpenedROI),$("#wdg-lightbox-transfer-roi #lightbox-content .loading-form input#hidden-isrefund").val(e.isRefund),$("#wdg-lightbox-transfer-roi #lightbox-content .loading-form").show()),$("#wdg-lightbox-transfer-roi #lightbox-content .loading-content").html(a),$("#wdg-lightbox-transfer-roi #lightbox-content .loading-image").hide()}))}),$("#proceed_roi_transfers_form").submit(function(t){t.preventDefault(),e.proceedRoyalties()})),$("#turnover-declaration").length>0){$("#turnover-total").length>0&&$("#turnover-total").change(function(){e.refreshTurnoverAmountToPay()});for(var t=0;$("#turnover-"+t).length>0;)$("#turnover-"+t).change(function(){e.refreshTurnoverAmountToPay()}),t++}$("#display-form-send-document").click(function(){$(this).slideUp(50),$("#form-send-document").slideDown(100)}),$("#display-list-declarations").click(function(){$(this).slideUp(50),$("#list-declarations").slideDown(100)}),$(".declaration-item-more-btn button").click(function(){var e=$(this).data("declaration");$("#declaration-item-more-"+e).is(":visible")?($("#declaration-item-more-btn-"+e+" button").text("+"),$("#declaration-item-"+e).removeClass("expanded"),$("#declaration-item-more-"+e).slideUp(50)):($("#declaration-item-more-btn-"+e+" button").text("-"),$("#declaration-item-"+e).addClass("expanded"),$("#declaration-item-more-"+e).slideDown(100))}),$("#display-form-add-adjustment").click(function(){$(this).slideUp(50),$("#form-add-adjustment").slideDown(100)}),$("#form-add-adjustment #field-turnover_difference #turnover_difference").change(function(){e.refreshAjustmentAmountToPay(!1)}),$(".adjustment-edit-form #field-turnover_difference #turnover_difference").change(function(){e.refreshAjustmentAmountToPay($(this).parent().parent().parent().parent())}),$(".adjustment-item-more-btn button").click(function(){var e=$(this).data("adjustment");$("#adjustment-item-more-"+e).is(":visible")?($("#adjustment-item-more-btn-"+e+" button").text("+"),$("#adjustment-item-"+e).removeClass("expanded"),$("#declaration-item-more-"+e).slideUp(50)):($("#adjustment-item-more-btn-"+e+" button").text("-"),$("#adjustment-item-"+e).addClass("expanded"),$("#adjustment-item-more-"+e).slideDown(100))}),$("div.adjustment-item-more div.adjustment-summary button.edit-adjustment").click(function(){var e=$(this).data("adjustment");$("div#adjustment-item-more-"+e+" .adjustment-summary").slideUp(50),$("div#adjustment-item-more-"+e+" .adjustment-edit-form").slideDown(100),$("div#adjustment-item-more-"+e+" .adjustment-edit-form select").each(function(){var e=this;$(this).children().each(function(){"selected"==$(this).attr("selected")&&$(e).val($(this).attr("value"))})})})},WDGCampaignDashboard.prototype.refreshTurnoverAmountToPay=function(){var e=$("#turnover-declaration").data("roi-percent"),t=$("#turnover-declaration").data("minimum-costs"),a=$("#turnover-declaration").data("costs-orga"),i=0;if($("#turnover-total").length>0)i=Number($("#turnover-total").val().split(",").join("."));else for(var n=0;$("#turnover-"+n).length>0;)i+=Number($("#turnover-"+n).val().split(",").join(".")),n++;var r=i*e/100,o=Math.max(t,r*a/100),s=r+o;s+=$("#turnover-declaration").data("adjustment"),s=Math.round(100*s)/100,$(".amount-to-pay").text(s),$(".commission-to-pay").text(o)},WDGCampaignDashboard.prototype.refreshAjustmentAmountToPay=function(e){var t="form-add-adjustment";!1!==e&&(t=e.attr("id"));var a=$("#"+t+" #field-roi_percent #roi_percent").val(),i=Number($("#"+t+" #field-turnover_difference #turnover_difference").val().split(",").join("."))*a/100;i=Math.round(100*i)/100,$("#"+t+" #field-amount #amount").val(i)},WDGCampaignDashboard.prototype.proceedRoyalties=function(){var e=this,t={action:"proceed_roi_transfers",campaign_id:$("#hidden-campaign-id").val(),roi_id:$("#hidden-roi-id").val(),isrefund:$("#hidden-isrefund").val(),send_notifications:$("#check_send_notifications").is(":checked"),transfer_remaining_amount:$("#check_transfer_remaining_amount").is(":checked")},a=$("#proceed_roi_transfers_button");a.find(".button-text").hide(),a.find(".button-waiting").show(),$.ajax({type:"POST",url:ajax_object.ajax_url,data:t}).done(function(t){if(100==t)$("#proceed_roi_transfers_percent").html("Versement effectu&eacute; !"),$("#proceed_roi_transfers_button").hide();else{var a=parseFloat(t);a=a.toFixed(2),$("#proceed_roi_transfers_percent").html(a+" %"),e.proceedRoyalties()}}).fail(function(){$("#proceed_roi_transfers_percent").html('<span class="error">Erreur serveur (ROI1611)</p>')})},WDGCampaignDashboard.prototype.manageTeam=function(e,t,a){var i=this;"yproject-add-member"===e?""===t||($("#new_team_member_string").prop("disabled",!0),$("#new_team_member_string").val(""),tmpPlaceHolder=$("#new_team_member_string").prop("placeholder"),$("#new_team_member_string").prop("placeholder","Ajout de "+t+"..."),$("#new_team_member_string").next().hide(),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"add_team_member",id_campaign:a,new_team_member:t}}).done(function(n){"FALSE"==n&&alert("Cet utilisateur n'a pas de compte sur la plateforme."),$("#new_team_member_string").prop("disabled",!1),$("#new_team_member_string").prop("placeholder",tmpPlaceHolder),$("#new_team_member_string").next().show(),"FALSE"===n?($("#new_team_member_string").next().next().after('<div id="fail_add_team_indicator"><br/><em>L\'utilisateur '+t+" n'a pas été trouvé</em><div>"),$("#fail_add_team_indicator").delay(4e3).fadeOut(400)):(res=JSON.parse(n),doublon=!1,$(".project-manage-team").each(function(){doublon=doublon||res.id==$(this).attr("data-user")}),doublon||(0==$("#team-list li").length&&$("#team-list").html(""),newline='<li style="display: none;">',newline+=res.firstName+" "+res.lastName+" ("+res.userLink+") ",newline+='<a class="project-manage-team button red" data-action="yproject-remove-member" data-user="'+res.id+'"><i class="fa fa-times fa-fw" aria-hidden="true"></i></a>',newline+="</li>",$("#team-list").append(newline),$("a[data-user="+res.id+"]").closest("li").slideDown(),$("#team-list-empty").hide(),$(".project-manage-team").click(function(){"yproject-add-member"===(e=$(this).attr("data-action"))?t=$("#new_team_member_string")[0].value:"yproject-remove-member"===e&&(t=$(this).attr("data-user")),i.manageTeam(e,t,a)})))})):"yproject-remove-member"===e&&($("a[data-user="+t+"]").closest("li").css("opacity",.5),$("a[data-user="+t+"]").html('<i class="fa fa-spinner fa-spin fa-fw"></i>'),$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"remove_team_member",id_campaign:a,user_to_remove:t}}).done(function(e){$("a[data-user="+t+"]").closest("li").slideUp("slow",function(){$(this).remove()})}))},WDGCampaignDashboard.prototype.initFinance=function(){WDGCampaignTurnoverSimulator=new WDGCampaignTurnoverSimulator},WDGCampaignDashboard.prototype.initCampaign=function(){$("#item-body-campaign ul input[type=checkbox]").prop("disabled",!1),$("#form-changing-from-vote").submit(function(e){confirm("Attention, le choix de la date de fin est définitif. Êtes-vous sûr(e) de valider cette date de fin ?")||e.preventDefault()})},WDGCampaignDashboard.prototype.initQtip=function(){$(".infobutton, .qtip-element").each(function(){if(void 0==$(this).data("hasqtip")){var e,t={content:e=void 0!=$(this).attr("title")?$(this).attr("title"):$(this).next(".tooltiptext").text(),position:{my:"bottom center",at:"top center"},style:{classes:"wdgQtip qtip-dark qtip-rounded qtip-shadow"},hide:{fixed:!0,delay:300}};$(this).is("input[type=text], input[type=number], textarea")&&(t.show="focus",t.hide="blur");var a=$(this).data("tooltip");if(void 0!=a){var i=JSON.parse(a);for(var n in i)t[n]=i[n]}""!=e&&$(this).qtip(t)}})},jQuery(document).ready(function(e){e("ul.nav-menu").length>0&&(wdgCampaignDashboard=new WDGCampaignDashboard)});